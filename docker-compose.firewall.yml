services:
  firewall-controller:
    build: ./firewall-controller
    container_name: fw-controller
    network_mode: "host"
    cap_add:
      - NET_ADMIN
    env_file:
      - .env
    environment:
      # IP/hostname của sensor machine nơi MySQL được publish
      DB_HOST: ${FW_DB_HOST:-127.0.0.1}
      DB_PORT: "3306"
      DB_USER: ${FW_DB_USER:-tls_user}
      DB_PASSWORD: ${FW_DB_PASSWORD}
      DB_NAME: ${FW_DB_NAME:-tls_ids}
      IPTABLES_CHAIN: "FORWARD"
      FW_DRY_RUN: "false"
      # MySQL TLS (khuyến nghị khi firewall-controller connect qua mạng thật) 
      # DB_TLS_ENABLED: "true"
      # DB_SSL_CA: "/pki/mysql/ca.pem"
      # DB_SSL_CERT: "/pki/mysql/fw-client.pem"
      # DB_SSL_KEY: "/pki/mysql/fw-client.key"
      # DB_SSL_VERIFY_CERT: "true"
      # DB_SSL_VERIFY_IDENTITY: "false"  # bật nếu mysql-connector hỗ trợ
    # Mount certs khi bật DB TLS:
    # volumes:
    #   - ./pki/mysql:/pki/mysql:ro
    volumes: []
    restart: unless-stopped
